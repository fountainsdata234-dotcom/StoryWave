:root{
  --bg:#0b1220; --panel:rgba(255,255,255,0.03); --card:rgba(255,255,255,0.02);
  --muted:#9aa4b2; --accent:#30d5c8; --text:#e6eef6; --radius:12px; --shadow:0 10px 40px rgba(2,6,23,0.55);
}
[data-theme="light"]{
  --bg:#f6f9fb; --panel:#ffffff22; --card:#fff; --muted:#475569; --accent:#2563eb; --text:#0b1220; --shadow:0 10px 30px rgba(2,6,23,0.06);
}
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%;font-family:"Poppins",system-ui,-apple-system,"Segoe UI",Roboto,Arial;color:var(--text);background:var(--bg);-webkit-font-smoothing:antialiased}
a{color:inherit;text-decoration:none}
.wrap{max-width:1100px;margin:24px auto;padding:18px;display:flex;flex-direction:column;gap:18px}

/* Header */
.site-header{position:fixed;top:0;left:0;right:0;display:flex;align-items:center;justify-content:space-between;padding:10px 20px;gap:12px;z-index:1100;transition:background 320ms,backdrop-filter 320ms,box-shadow 320ms;background:transparent}
.site-header.scrolled{background:rgba(2,6,23,0.6);backdrop-filter:blur(8px);box-shadow:0 8px 30px rgba(0,0,0,0.4)}
.brand{display:flex;align-items:center;gap:12px}
.book-logo {
  width: 46px;
  height: 34px; /* Make it more book-shaped */
  position: relative;
  perspective: 1000px;
  animation: book-shake 5s ease-in-out infinite;
}
.book-logo-page {
  position: absolute;
  width: 100%;
  height: 100%;
  border-radius: 4px;
  transform-origin: left center;
  animation: flip 3.5s ease-in-out infinite;
  box-shadow: 0 2px 10px rgba(0,0,0,0.2);
}
.book-logo-page:nth-child(1) { background: linear-gradient(135deg, #30d5c8, #3b82f6); animation-delay: -1.1s; }
.book-logo-page:nth-child(2) { background: linear-gradient(135deg, #a855f7, #ec4899); animation-delay: -2.2s; }
.book-logo-page:nth-child(3) { background: linear-gradient(135deg, #f97316, #eab308); animation-delay: -3.3s; }
@keyframes flip {
  0%, 15% { transform: rotateY(0deg); }
  85%, 100% { transform: rotateY(-180deg); }
}
@keyframes book-shake {
  0%, 100% { transform: translateY(0) rotate(-1deg); }
  50% { transform: translateY(-3px) rotate(1deg); }
}
.brand-text .site-title{font-weight:700;font-size:16px}
.muted{color:var(--muted);font-size:13px}

/* Desktop nav */
.desktop-nav{display:flex;gap:14px;padding-left:12px}
.nav-link{color:var(--muted);font-weight:600;padding:8px 10px;border-radius:8px}
.nav-link.active{background:linear-gradient(90deg,var(--accent), rgba(96,195,255,0.2));color:var(--text);box-shadow:0 8px 24px rgba(2,6,23,0.15)}

/* Controls */
.controls{display:flex;align-items:center;gap:12px}
.search-wrap{position:relative;display:flex;align-items:center;gap:8px}
.search-input{padding:10px 12px;border-radius:12px;background:var(--panel);border:none;color:var(--text);min-width:220px;max-width:38vw}
.search-btn{padding:10px 12px;border-radius:12px;border:none;background:linear-gradient(90deg,var(--accent),#60c3ff);color:white;font-weight:700;cursor:pointer}
.suggestions{position:absolute;top:54px;left:0;right:0;background:linear-gradient(180deg, rgba(2,6,23,0.9), rgba(2,6,23,0.95));padding:8px;border-radius:10px;display:none;flex-direction:column;gap:6px;box-shadow:var(--shadow);z-index:1200}
.suggestions .item{display:flex;gap:8px;align-items:center;padding:8px;border-radius:8px;cursor:pointer}
.suggestions img{width:36px;height:54px;object-fit:cover;border-radius:6px}

/* User Profile in Header */
.user-profile { display: flex; align-items: center; gap: 10px; }
.user-profile img { width: 38px; height: 38px; border-radius: 50%; }
.user-profile .btn { padding: 8px 14px; }
@media (max-width: 640px) {
  .user-profile { display: none; }
}

/* Theme toggle & hamburger */
.theme-toggle{background:var(--panel);padding:8px;border-radius:999px;border:none;cursor:pointer;display:flex;align-items:center;gap:8px}
.hamburger{width:44px;height:40px;border-radius:10px;background:var(--panel);border:none;display:none;align-items:center;justify-content:center;cursor:pointer;position:relative}
.hamburger::before, .hamburger::after {
  content: ''; position: absolute; width: 18px; height: 2px; background: var(--text);
  border-radius: 2px; transition: transform 0.3s ease;
}
.hamburger::before { transform: translateY(-5px); }
.hamburger::after { transform: translateY(5px); }
.hamburger.open::before { transform: translateY(0) rotate(45deg); }
.hamburger.open::after { transform: translateY(0) rotate(-45deg); }


/* Mobile menu */
.mobile-menu{position:fixed;right:18px;top:70px;width:280px;border-radius:12px;padding:12px;box-shadow:var(--shadow);display:none;z-index:1100}
.mobile-menu.open{display:block}
.mobile-user{display:flex;gap:10px;align-items:center;padding:5px;border-bottom:1px solid rgba(255,255,255,0.03)}
.mobile-user img{width:44px;height:44px;border-radius:50%}
.mobile-nav-links {
  display: flex; flex-direction: column; gap: 8px;
  margin: 12px 0; padding: 12px 0;
  border-top: 1px solid rgba(255,255,255,0.03);
  border-bottom: 1px solid rgba(255,255,255,0.03);
}
.mobile-actions{display:flex;flex-direction:column;gap:8px;margin-top:8px}

/* Carousel */
.hero{margin-top:88px;border-radius:14px;overflow:hidden;box-shadow:var(--shadow);background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01))}
.carousel-track{
  width:100%;display:flex;gap:14px;padding:16px;overflow-x:auto;scroll-behavior:smooth;
  scroll-snap-type: x mandatory; /* Enable snapping on the horizontal axis */
}
.carousel-slide{
  flex:0 0 520px;border-radius:12px;display:flex;align-items:center;justify-content:space-between;padding:18px;background-size:cover;background-position:center;min-height:220px;
  scroll-snap-align: start; /* Each slide's start is a snap point */
}
.slide-text{max-width:58%;background:linear-gradient(180deg, rgba(0,0,0,0.12), rgba(0,0,0,0.02));padding:12px;border-radius:10px}
.slide-text h3{margin:0;font-size:20px}
.slide-cover{width:220px;border-radius:12px;overflow:hidden;box-shadow:var(--shadow)}
.slide-cover img{width:100%;height:100%;object-fit:cover;display:block}

/* Last reads */
.last-reads{margin-top:12px;padding:12px;background:var(--card);border-radius:12px}
.last-reads-row{display:flex;gap:12px;overflow-x:auto;padding-top:12px}
.last-card{min-width:220px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:12px;border-radius:10px;display:flex;gap:10px;align-items:center}
.last-card {
  min-width: 180px; /* Make cards a bit narrower to fit more */
  flex-direction: column; /* Stack content vertically */
  align-items: center; /* Center content */
  text-align: center;
}
.last-card img{width:72px;height:96px;object-fit:cover;border-radius:6px}
.last-card h4 {
  width: 100%;
  height: 42px; /* Reserve space for two lines */
  line-height: 1.5;
  overflow: hidden;
  text-overflow: ellipsis;
  display: -webkit-box;
  -webkit-line-clamp: 2; /* Limit to 2 lines */
  -webkit-box-orient: vertical;
  margin: 8px 0 4px;
}

/* Explore grid */
.explore-section{margin-top:12px}
.cards-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;transition:all 300ms ease}
.card{background:var(--card);padding:10px;border-radius:10px;box-shadow:var(--shadow);display:flex;flex-direction:column;align-items:center;text-align:center}
.card .thumb{width:128px;height:180px;border-radius:8px;overflow:hidden}
.card .thumb img{width:100%;height:100%;object-fit:cover}
.card h4{margin:10px 0 6px;font-size:15px}
.card h4 {
  width: 100%;
  height: 45px; /* Reserve space for two lines */
  line-height: 1.5;
  overflow: hidden;
  text-overflow: ellipsis;
  display: -webkit-box;
  -webkit-line-clamp: 2; /* Limit to 2 lines */
  -webkit-box-orient: vertical;
}
.card p{color:var(--muted);font-size:13px;margin:0 0 8px}
.card p {
  width: 90%; /* Prevent text from touching card edges */
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.card .actions{display:flex;gap:8px;flex-wrap:wrap;justify-content:center}
.card .favorite-btn {
  background: transparent; border: 1px solid var(--panel); color: var(--muted);
  cursor: pointer;
  width: 36px; height: 36px; border-radius: 50%; padding: 0; font-size: 18px;
}
.card .favorite-btn.active { background: #ef444422; color: #ef4444; border-color: #ef444444; }

/* Genre Filters */
.genre-filters{display:flex;flex-wrap:wrap;gap:8px}
.genre-btn{padding:6px 14px;border-radius:999px;border:1px solid var(--panel);background:transparent;color:var(--muted);cursor:pointer;transition:all 200ms ease}
.genre-btn:hover{background:var(--panel);color:var(--text)}
.genre-btn.active{background:linear-gradient(90deg,var(--accent),#60c3ff);color:white;border-color:transparent;font-weight:600}

/* Favorites Section */
.favorites-section { margin-top: 12px; padding: 12px; background: var(--card); border-radius: 12px; }
.favorites-row {
  display: flex;
  gap: 12px;
  overflow-x: auto;
  padding-top: 12px;
}
.favorites-row .card {
  min-width: 180px; /* Similar to last-card to fit more on a line */
  flex-shrink: 0; /* Prevent cards from shrinking */
  flex-direction: column; /* Stack content vertically within the card */
  align-items: center; /* Center content within the card */
  text-align: center;
  /* Override default card grid styles that might be inherited */
  width: auto; /* Allow min-width to take effect */
  flex-basis: 180px; /* Ensure cards have a consistent base width */
}

/* Load more button wrap */
.load-more-wrap {
  margin-top: 24px;
  display: flex;
  justify-content: center;
}

/* Buttons */
.btn{padding:8px 12px;border-radius:8px;border:none;background:linear-gradient(90deg,var(--accent),#60c3ff);color:white;font-weight:700;cursor:pointer}
.btn.secondary{background:transparent;color:var(--text);border:1px solid rgba(255,255,255,0.06)}
.btn.small{padding:6px 8px;font-size:13px}
.btn:disabled { opacity: 0.7; cursor: not-allowed; }
#loadMoreBtn {
  background: linear-gradient(90deg, #30d5c8, #a855f7, #f97316, #eab308, #30d5c8);
  background-size: 300% 100%;
  animation: colorful-flow 5s linear infinite;
}
@keyframes colorful-flow { to { background-position: 300% 0; } }

/* Spinner for loading buttons */
.spinner {
  display: inline-block; width: 1em; height: 1em; border: 2px solid currentColor;
  border-right-color: transparent; border-radius: 50%;
  animation: spinner-spin .75s linear infinite;
}
@keyframes spinner-spin { to { transform: rotate(360deg); } }

/* Modals */
.modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.55);z-index:1200}
.modal.visible{display:flex} /* This was missing for auth modal */
.modal-panel{background:linear-gradient(180deg,#03122b,#041a33);padding:24px;border-radius:12px;color:var(--text);width:96%;max-width:480px;box-shadow:var(--shadow);text-align:center}
.modal-panel .modal-close{position:absolute;right:18px;top:18px;background:linear-gradient(90deg,var(--accent),#60c3ff);border:none;color:white;padding:8px;border-radius:999px;cursor:pointer}

/* Auth Modal Specifics */
.auth-modal h2 { margin-bottom: 8px; font-size: 24px; }
.auth-modal p.muted { margin-bottom: 20px; line-height: 1.4; }
.auth-input-group { margin-bottom: 15px; text-align: left; }
.auth-input-group label { display: block; font-size: 13px; color: var(--muted); margin-bottom: 4px; }
.auth-input-group input {
  width: 100%; padding: 12px 15px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1);
  background: rgba(0,0,0,0.2); color: var(--text); font-size: 16px;
}
.auth-input-group input::placeholder { color: var(--muted); opacity: 0.7; }
.auth-buttons { display: flex; flex-direction: column; gap: 10px; margin-top: 20px; }
.auth-buttons .btn { width: 100%; }
.auth-divider { display: flex; align-items: center; text-align: center; margin: 25px 0; color: var(--muted); }
.auth-divider::before, .auth-divider::after { content: ''; flex: 1; border-bottom: 1px solid rgba(255,255,255,0.1); }
.auth-divider:not(:empty)::before { margin-right: .25em; }
.auth-divider:not(:empty)::after { margin-left: .25em; }
.auth-message { margin-top: 15px; font-size: 14px; color: #ef4444; } /* Error color */

/* Rating Stars */
.rating-stars {
  display: inline-block;
  font-size: 24px;
  cursor: pointer;
  color: var(--muted); /* Default color for unrated stars */
}
.rating-stars .star {
  transition: color 0.2s ease;
}
.rating-stars .star.active,
.rating-stars .star:hover,
.rating-stars .star:hover ~ .star {
  color: gold; /* Color for rated/hovered stars */
}

/* Recent Ratings List */
.recent-rating-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 0;
  border-bottom: 1px solid var(--panel);
  font-size: 14px;
}

/* Reader */
.reader-modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(2,6,14,0.6);z-index:1400;padding:0}
.reader-modal.visible{display:flex}
.reader-close {
  position: fixed; top: 20px; right: 20px; z-index: 1401;
  width: 44px; height: 44px; border-radius: 50%; border: none;
  background: #e53e3e; color: white; font-size: 20px; font-weight: bold;
  cursor: pointer; box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  animation: reader-close-pulse 2s infinite;
}
@keyframes reader-close-pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.08); } }
.reader-panel{width:100vw;height:100vh;border-radius:0;overflow:hidden;backdrop-filter:blur(8px);background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));box-shadow:var(--shadow)}
.reader-header{display:flex;align-items:center;justify-content:space-between;padding:14px;border-bottom:1px solid rgba(255,255,255,0.03)}
.reader-controls{display:flex;align-items:center;padding:10px;gap:8px}
.reader-frame{padding:0;height:calc(100vh - 100px);overflow:auto;background:transparent;border-radius:0;margin:0}
.reader-text{max-width:880px;margin:0 auto;color:var(--text);line-height:1.7;font-size:20px;background:rgba(255,255,255,0.02);padding:28px;border-radius:8px}
.reader-text p{margin:0 0 12px}
.reader-text h1, .reader-text h2, .reader-text h3, .reader-text h4 { margin: 2em 0 1em; }
.reader-text pre { white-space: pre-wrap; background: rgba(0,0,0,0.1); padding: 1em; border-radius: 8px; }
.reader-frame #epub-viewer { width: 100%; height: 100%; }
.reader-frame #epub-viewer iframe { background-color: #fff; }

/* Reader Dark Mode */
.reader-panel.reader-dark-mode .reader-frame #epub-viewer iframe {
  filter: invert(1) hue-rotate(180deg);
}

/* Style the content inside the epub.js iframe */
.epub-view > iframe { background-color: transparent !important; }
/* Use a class to target the body inside the iframe for theming */
.epub-view > iframe body.epub-dark { color: #e6eef6 !important; }
.epub-view > iframe body.epub-light { color: #0b1220 !important; }

/* footer & misc */
.site-footer {
  max-width: 1100px;
  margin: 48px auto 24px;
  padding-top: 24px;
  color: var(--muted);
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 24px;
  border-top: 1px solid var(--panel);
}
.footer-column strong { color: var(--text); }
.footer-disclaimer { grid-column: 1 / -1; text-align: center; font-size: 12px; opacity: 0.7; }

.back-top{position:fixed;right:18px;bottom:18px;background:linear-gradient(90deg,var(--accent),#60c3ff);border:none;color:white;padding:10px;border-radius:999px;display:none;z-index:1500}

/* stars & shapes */
#starfield{position:fixed;inset:0;z-index:-2;pointer-events:none}
#floating-shapes{position:fixed;inset:0;z-index:-1;pointer-events:none;overflow:visible}
.shape{position:absolute;width:120px;height:120px;border-radius:18px;background:linear-gradient(135deg, rgba(48,213,200,0.12), rgba(96,195,255,0.12));filter:blur(12px);opacity:0.85;transition:opacity 300ms ease, transform 800ms ease}
.shape.small{width:84px;height:84px;border-radius:14px}
.shape.hidden{opacity:0;transform:scale(0.9)}

/* responsive */
@media (max-width:980px){ .cards-grid{grid-template-columns:repeat(2,1fr)} .hero{margin-top:96px} }
@media (max-width:640px){
  .site-header { flex-wrap: wrap; }
  .controls { order: 3; width: 100%; }
  .search-wrap { flex-grow: 1; margin-right: auto; }
  .desktop-nav{display:none}
  .hamburger{display:flex}
  .mobile-menu{right:12px;top:112px;width:calc(100% - 24px);max-width:400px}
  .cards-grid{grid-template-columns:1fr}
  .search-input{min-width:110px;max-width:none;width:100%} 
  .carousel-slide{flex:0 0 88%}
  .slide-cover { display: none; } /* Hide cover on small screens */
  .site-footer {
    grid-template-columns: 1fr;
    text-align: center;
  }
  .footer-column { text-align: center !important; }
  .reader-panel{width:100vw;height:100vh}
  .reader-frame{height:calc(100vh - 140px)}
  .reader-text{padding:18px;font-size:18px}
}
